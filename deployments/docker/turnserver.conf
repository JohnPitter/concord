# =============================================================================
# coturn TURN Server Configuration for Concord
# =============================================================================
# Docs: https://github.com/coturn/coturn/wiki/turnserver
# =============================================================================

# ---- Network ----------------------------------------------------------------

# STUN/TURN listening port (standard)
listening-port=3478

# TLS listening port
tls-listening-port=5349

# Relay port range (WebRTC media relay)
min-port=49152
max-port=65535

# ---- Authentication ---------------------------------------------------------

# Realm for TURN credentials
realm=concord

# Enable fingerprint in TURN messages (RFC 5389)
fingerprint

# Use long-term credential mechanism
lt-cred-mech

# Use TURN REST API shared secret (preferred for WebRTC)
# The actual secret is injected via TURN_SECRET environment variable
# coturn reads this from the config; override with --static-auth-secret flag
# or set via environment substitution in the entrypoint
use-auth-secret
static-auth-secret=${TURN_SECRET}

# ---- Security ---------------------------------------------------------------

# Disable old/insecure protocols
no-tlsv1
no-tlsv1_1

# Prevent relaying to private IP ranges (mitigate SSRF)
denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=172.16.0.0-172.31.255.255
denied-peer-ip=192.168.0.0-192.168.255.255

# Rate limiting: max allocations per user
total-quota=100
user-quota=10

# Max bytes-per-second bandwidth per session (1 Mbps)
max-bps=131072

# ---- Logging ----------------------------------------------------------------

# Log to stdout for Docker log collection
log-file=stdout

# Verbose logging (disable in production for performance)
# verbose

# ---- Performance -------------------------------------------------------------

# Number of relay threads (0 = auto based on CPU cores)
relay-threads=0

# Stale nonce lifetime (seconds)
stale-nonce=600
