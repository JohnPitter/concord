# =============================================================================
# coturn TURN Server Configuration for Concord
# =============================================================================
# Docs: https://github.com/coturn/coturn/wiki/turnserver
# =============================================================================

# ---- Network ----------------------------------------------------------------

# STUN/TURN listening port (standard)
listening-port=3478

# Listen on all interfaces inside container
listening-ip=0.0.0.0
relay-ip=0.0.0.0

# Disable TLS listeners by default (TURN over TCP/UDP only).
no-tls
no-dtls

# Relay port range (WebRTC media relay)
min-port=49160
max-port=49220

# ---- Authentication ---------------------------------------------------------

# Realm for TURN credentials
realm=concord

# Enable fingerprint in TURN messages (RFC 5389)
fingerprint

# Use TURN REST API shared secret (preferred for WebRTC)
# The shared secret is injected at runtime via `--static-auth-secret`.
use-auth-secret

# ---- Security ---------------------------------------------------------------

# Prevent relaying to private IP ranges (mitigate SSRF)
denied-peer-ip=10.0.0.0-10.255.255.255
denied-peer-ip=172.16.0.0-172.31.255.255
denied-peer-ip=192.168.0.0-192.168.255.255

# Rate limiting: max allocations per user
total-quota=100
user-quota=10

# Max bytes-per-second bandwidth per session (1 Mbps)
max-bps=131072

# ---- Logging ----------------------------------------------------------------

# Log to stdout for Docker log collection
log-file=stdout

# Verbose logging (disable in production for performance)
# verbose

# ---- Performance -------------------------------------------------------------

# Number of relay threads (0 = auto based on CPU cores)
relay-threads=0

# Stale nonce lifetime (seconds)
stale-nonce=600
